# CAD_file_operations.py 函数测试命令手册

**更新日期**: 2025-11-17
**适用文件**: `D:/claude-tasks/cad/scripts/CAD_file_operations.py`

---

## 使用说明

**是否需要手动打开CAD？**
- **不需要！** 所有测试脚本会自动启动天正CAD、执行测试、清理进程
- 直接运行测试命令即可

**预备文件位置**：`D:/claude-tasks/cad/tests/test_files/preset/`

---

## 一、文件基础操作函数（5个）

### 1. new_file() - 新建文件

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_new_file.py
```

**预备测试文件**：无需（创建新文件）

**测试内容**：
- 新建空白DWG文件
- 验证文件是否成功创建

**预期结果**：成功创建新的DWG文件

---

### 2. open_file() - 打开文件

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_open_file.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_open.dwg`

**文件内容**：
- 包含一个圆形（中心0,0，半径50）

**预期结果**：成功打开文件并显示圆形

---

### 3. copy_file_with_increment() - 复制文件并自动编号

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_copy_file_increment.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_copy_source.dwg`

**文件内容**：
- 包含一个矩形（0,0到100,100）

**测试状态**：✅ 已测试通过

**预期结果**：
- 第1次复制：`preset_copy_source-1.dwg`
- 第2次复制：`preset_copy_source-2.dwg`
- ...依次递增

---

### 4. save_file() - 保存当前文件

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_save_file.py
```

**预备测试文件**：无需（保存当前打开的文件）

**测试内容**：
- 打开文件，修改内容，保存

**预期结果**：文件成功保存修改

---

### 5. save_file_as() - 另存为文件

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_save_file_as.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_saveas_source.dwg`

**文件内容**：
- 包含一个圆形（中心50,50，半径30）

**预期结果**：文件成功另存为新文件

---

## 二、文件关闭操作函数（2个）

### 6. close_file() - 关闭当前文件

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_close_file.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_close.dwg`

**文件内容**：
- 包含一个多段线（封闭矩形）

**预期结果**：文件成功关闭

---

### 7. close_all_files() - 关闭所有文件

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_close_all_files.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_close_all_1.dwg`
- `D:/claude-tasks/cad/tests/test_files/preset/preset_close_all_2.dwg`

**文件内容**：
- 文件1：包含圆形（中心0,0，半径25）
- 文件2：包含圆形（中心100,0，半径25）

**测试状态**：✅ 已测试通过

**预期结果**：所有打开的文件都被关闭

---

## 三、文件插入操作函数（4个）

### 8. insert_file_as_block() - 将文件作为块插入

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_insert_as_block.py
```

**预备测试文件**：
- **源文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_block_source.dwg`
- **目标文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_block_target.dwg`

**文件内容**：
- 源文件：圆形（中心0,0，半径30）+ 矩形（-20,-20到20,20）
- 目标文件：圆形（中心200,200，半径10）

**测试状态**：✅ 已测试通过

**预期结果**：
- 源文件内容作为块插入到目标文件
- 插入位置：(100, 100)

---

### 9. insert_file_exploded() - 将文件炸开插入

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_insert_exploded.py
```

**预备测试文件**：
- **源文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_explode_source.dwg`
- **目标文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_explode_target.dwg`

**文件内容**：
- 源文件：矩形（0,0到50,50）+ 圆形（中心25,25，半径20）
- 目标文件：圆形（中心300,300，半径15）

**测试状态**：✅ 已测试通过

**预期结果**：
- 源文件内容炸开后插入到目标文件
- 插入位置：(200, 200)
- 图形可独立编辑

---

### 10. copy_file_content_pywin32() - 复制文件内容（pywin32方式）

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_copy_file_content.py
```

**预备测试文件**：
- **源文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_content_source.dwg`
- **目标文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_content_target.dwg`

**文件内容**：
- 源文件：圆形（中心0,0，半径40）+ 矩形（10,10到60,60）+ 三角形
- 目标文件：圆形（中心500,500，半径20）

**预期结果**：
- 源文件所有内容复制到目标文件
- 保持原有位置和属性

---

### 11. insert_region_from_file() - 从文件插入区域

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_insert_region_from_file_optimized.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_region_source.dwg`

**文件内容**：
- 矩形（10,10到90,90）**[在区域内]**
- 圆形（中心250,50，半径30）**[在区域外]**
- 三角形（20,20-50,80-80,20）**[在区域内]**

**测试参数**：
- 选择区域：(0,0) 到 (100,100)
- 插入位置：(150,150)

**测试状态**：✅ 已测试通过

**预期结果**：
- 在(150,150)位置有矩形和三角形
- **没有**圆形（因为圆形在区域外）

---

### 12. insert_region_between_files() - 跨文件区域插入

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_insert_region_between_files.py
```

**预备测试文件**：
- **目标文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_region_A.dwg`
- **源文件**：`D:/claude-tasks/cad/tests/test_files/preset/preset_region_B.dwg`

**文件内容**：
- A文件：圆形（中心0,0，半径50）
- B文件：矩形（10,10到90,90）+ 圆形（250,50）+ 三角形

**测试参数**：
- 从B文件选择区域：(0,0) 到 (100,100)
- 插入到A文件位置：(150,150)

**测试状态**：✅ 已测试通过

**预期结果**：
- A文件在(150,150)有矩形和三角形
- **不应有**B文件的圆形(250,50)

---

## 四、天正建筑操作函数（4个）

### 13. dim_by_points() - 天正标注

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_dim_by_points.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_dim_target.dwg`

**文件内容**：
- 直线1：(0,0) 到 (1000,0)
- 直线2：(0,0) 到 (0,1000)

**预期结果**：
- 成功标注直线尺寸

---

### 14. draw_tarch_wall() - 绘制天正墙体

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_draw_tarch_wall_fixed.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_wall_target.dwg`

**文件内容**：
- 空白文件（用于绘制墙体）

**测试参数**：
- 起点：(0, 0, 0)
- 终点：(3000, 0, 0)
- 墙厚：240mm

**测试状态**：✅ 已测试通过

**预期结果**：
- 成功绘制天正墙体
- 执行时间：3.4-4.0秒

---

### 15. insert_tarch_door() - 插入天正门

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_insert_tarch_door_triangle.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_door_wall.dwg`

**文件内容**：
- 包含一段天正墙体（用于插入门）

**测试参数**：
- 门类型：三角形门
- 门宽：900mm

**测试状态**：✅ 已测试通过

**预期结果**：
- 成功在墙上插入天正门
- 执行时间：约2.8秒/门

---

### 16. insert_tarch_window() - 插入天正窗

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_insert_tarch_window_rectangle.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_window_wall.dwg`

**文件内容**：
- 包含一段天正墙体（用于插入窗）

**测试参数**：
- 窗类型：矩形窗
- 窗宽：1200mm

**测试状态**：✅ 已测试通过

**预期结果**：
- 成功在墙上插入天正窗
- 执行时间：首次13.5秒，后续7.9-8.1秒

---

## 五、CAD会话管理函数（2个）

### 17. start_cad_session() - 启动CAD会话

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_start_cad_session.py
```

**预备测试文件**：无需（启动CAD）

**预期结果**：
- 成功启动天正CAD T20V9
- CAD进入就绪状态

---

### 18. restore_to_uncertain_state() - 恢复到不确定状态

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_restore_state.py
```

**预备测试文件**：无需（恢复状态）

**测试状态**：✅ 已测试通过

**预期结果**：
- CAD恢复到单文件不确定状态
- 执行时间：3-8秒

---

## 六、多文档管理函数（1个）

### 19. activate_document_by_name() - 激活指定文档

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_activate_document.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/tests/test_files/preset/preset_activate_1.dwg`
- `D:/claude-tasks/cad/tests/test_files/preset/preset_activate_2.dwg`

**文件内容**：
- 文件1：矩形（0,0到50,50）
- 文件2：矩形（100,0到150,50）

**测试状态**：✅ 已测试通过

**预期结果**：
- 成功在两个打开的文档间切换
- 激活指定文档

---

## 七、CAD状态管理函数（5个）

### 20. cad_zt_zero() - 零状态（关闭所有进程）

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_cad_zt_zero.py
```

**预备测试文件**：无需（清理进程）

**预期结果**：
- 关闭所有CAD进程
- 系统恢复到零状态

---

### 21. cad_zt_oneb() - 状态1b（单进程+未保存空白图）

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_cad_zt_oneb.py
```

**预备测试文件**：无需（状态管理）

**预期结果**：
- 单个CAD进程
- 一张未保存的空白图

---

### 22. cad_zt_oned() - 状态1d（单进程+指定DWG）

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_cad_zt_oned.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/xitongwenjian/0.dwg`（系统文件）

**预期结果**：
- 单个CAD进程
- 打开指定的0.dwg文件

---

### 23. cad_zt_two() - 状态2（单进程+两个DWG）

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_cad_zt_two.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/xitongwenjian/0.dwg`（系统文件）
- `D:/claude-tasks/cad/xitongwenjian/1.dwg`（系统文件）

**预期结果**：
- 单个CAD进程
- 同时打开0.dwg和1.dwg

---

### 24. cad_zt_much() - 状态多（单进程+多个DWG）

**测试命令**：
```bash
python D:\claude-tasks\cad\tests\test_cad_zt_much.py
```

**预备测试文件**：
- `D:/claude-tasks/cad/xitongwenjian/0.dwg`（系统文件）
- `D:/claude-tasks/cad/xitongwenjian/1.dwg`（系统文件）
- `D:/claude-tasks/cad/xitongwenjian/2.dwg`（系统文件）

**预期结果**：
- 单个CAD进程
- 同时打开多个DWG文件

---

## 八、批量测试命令

### 运行全部测试

```bash
python D:\claude-tasks\cad\tests\run_all_function_tests.py
```

### 生成Excel测试报告

```bash
python D:\claude-tasks\cad\tests\generate_excel_report.py
```

### 生成所有预备测试文件

```bash
python D:\claude-tasks\cad\tests\create_preset_test_files.py
```

---

## 九、测试状态总览

| 状态 | 数量 | 百分比 | 函数列表 |
|------|------|--------|----------|
| ✅ 已测试 | 10 | 42% | copy_file_with_increment, close_all_files, insert_file_as_block, insert_file_exploded, insert_region_from_file, insert_region_between_files, draw_tarch_wall, insert_tarch_door, insert_tarch_window, restore_to_uncertain_state, activate_document_by_name |
| 待测试 | 14 | 58% | new_file, open_file, save_file, save_file_as, close_file, copy_file_content_pywin32, dim_by_points, start_cad_session, cad_zt_zero, cad_zt_oneb, cad_zt_oned, cad_zt_two, cad_zt_much |
| **总计** | **24** | **100%** | |

---

## 十、性能基准参考

| 操作类型 | 预期时间 | 超时阈值 |
|---------|---------|---------|
| 文件基础操作 | <1秒 | 10秒 |
| 墙体绘制 | 3.4-4.0秒 | 60秒 |
| 门插入 | 2.8秒/门 | 30秒 |
| 窗插入（首次） | 13.5秒 | 60秒 |
| 窗插入（后续） | 7.9-8.1秒 | 30秒 |
| 状态管理 | 3-8秒 | 30秒 |

**超过预期时间2倍以上需要优化。**

---

**文档维护**：
- 每次新增函数：添加测试命令说明
- 每次测试完成：更新测试状态
- 每次修改函数：重新测试并更新文档
