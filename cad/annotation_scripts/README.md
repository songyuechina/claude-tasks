# CAD坐标标注脚本使用说明

## 脚本概述

本文件夹包含用于为CAD图纸添加坐标标注的Python脚本。这些脚本可以自动为DWG文件中的点添加带引线的坐标标注。

## 文件说明

### 1. add_leader_labels.py（推荐使用）
**用途**: 使用LEADER命令为DWG文件添加坐标标注

**特点**:
- 使用命令行方式，稳定性好
- 支持引线(Leader)连接点和标注
- 标注距离约14个单位
- 标注方向：右上45度
- 格式：X={地理X坐标},Y={地理Y坐标}

**使用方法**:
```bash
python add_leader_labels.py
```

**注意事项**:
- 脚本会自动处理两张图纸
- 坐标转换：地理X→DWG的Y轴，地理Y→DWG的X轴
- 需要确保天正CAD V9已安装在 `C:\Tangent\TArchT20V9`

### 2. add_professional_labels.py
**用途**: 使用COM API的AddMText和AddLeader方法添加标注

**特点**:
- 使用COM自动化
- 可精确控制文字高度和引线样式
- 创建专门的COORD_ANN图层

**状态**: 由于COM稳定性问题，建议使用 add_leader_labels.py

### 3. add_coordinate_labels.py / add_coordinate_labels_2.py
**用途**: 使用简单TEXT命令添加标注（无引线）

**特点**:
- 简单直接的文字标注
- 不带引线
- 适合快速标注

## 坐标转换说明

所有脚本都会进行坐标转换：
- **地理坐标X** → **DWG坐标Y**
- **地理坐标Y** → **DWG坐标X**

例如：
- 地理坐标：(3084591.190, 380592.128)
- DWG坐标：(380592.128, 3084591.190)

## 第一张图的坐标点（4个点）

```python
original_coords_1 = [
    (3084591.190, 380592.128),  # 点1
    (3084586.139, 380581.243),  # 点2
    (3084577.068, 380585.452),  # 点3
    (3084582.119, 380596.337),  # 点4
]
```

## 第二张图的坐标点（6个点）

```python
original_coords_2 = [
    (3083641.673, 381378.081),  # P1
    (3083634.821, 381387.414),  # P2
    (3083644.548, 381393.696),  # P3
    (3083645.613, 381393.914),  # P4
    (3083648.003, 381392.157),  # P5
    (3083651.207, 381388.858),  # P6
]
```

## 依赖的模块

所有脚本依赖以下模块（位于 `D:\claude-tasks\scripts`）：
- `CAD_basic.py` - CAD启动和关闭
- `CAD_basic_operations.py` - 基本文件操作
- `CAD_coordination.py` - 协同和同步机制

## 常见问题

### Q: 脚本运行失败，提示COM错误
**A**: 使用 `add_leader_labels.py`，它使用命令行方式更稳定。

### Q: 如何修改标注距离？
**A**: 在脚本中修改 `distance` 参数（默认14.0单位）。

### Q: 如何修改文字高度？
**A**: 在使用TEXT命令的脚本中，文字高度固定为14。在COM版本中可通过 `text_height` 参数调整。

### Q: 标注位置不合适怎么办？
**A**: 可以修改脚本中的角度参数（默认45度）或距离参数。

## 改进方向

未来可以考虑：
1. 支持自定义标注位置和角度
2. 支持批量处理多个DWG文件
3. 添加GUI界面
4. 支持从Excel或CSV文件读取坐标
5. 增加标注样式的自定义选项

## 版本历史

- **2025-11-07**: 创建初始版本，实现LEADER命令标注功能
- **2025-11-07**: 尝试COM API方案，因稳定性问题回退到命令行方案

## 联系方式

如需改进或有问题，请参考 `D:\claude-tasks\即时对话.txt` 中的记录。
