# Claude 配置系统使用指南

## 🎯 配置系统概述

这个配置系统让 Claude 在执行 CAD 任务时自动遵循规范，无需每次手动提醒。

### 核心组件

1. **`.claude/CLAUDE_BEHAVIOR_RULES.md`** - Claude 的行为准则（10条强制规则）
2. **`.claude/commands/cad.md`** - `/cad` 命令（启动 CAD 模式）
3. **`.claude/commands/init.md`** - `/init` 命令（初始化环境）
4. **`.claude/claude_config.json`** - 配置参数

## 🚀 快速开始

### 第一步：验证配置

运行验证脚本确保配置正确：

```bash
python .claude/verify_config.py
```

应该看到：
```
✅ 所有配置检查通过！
通过率: 100.0%
```

### 第二步：使用命令

#### 方式 1：初始化环境（新会话开始时）

```
/init
```

**效果**：
- 显示工作站信息
- 列出可用命令
- 说明权限配置

#### 方式 2：启动 CAD 模式（执行 CAD 任务时）

```
/cad
```

**效果**：
- 加载完整的 CAD 操作规范
- 强制使用范式函数
- 自动遵循协同机制
- 详细记录操作日志

## 📋 使用示例

### 示例 1：简单的 CAD 操作

```
用户：/cad
用户：打开 D:/test/sample.dwg

Claude 会自动：
1. 识别这是 CAD 文件操作任务
2. 阅读 CAD_操作规范.md 和 CAD_基本操作范式.md
3. 使用 open_dwg_paradigm() 函数（而不是直接调用 COM API）
4. 遵循协同机制（等待命令完成）
5. 输出详细的操作日志
```

### 示例 2：CAD 测试任务

```
用户：/cad
用户：测试 CAD 打开和关闭文件功能

Claude 会自动：
1. 识别这是测试任务
2. 阅读 CAD_测试规范.md
3. 使用 CAD_test_framework.py 测试框架
4. 遵循测试八大原则
5. 创建符合规范的测试脚本
6. 记录详细的测试日志
```

### 示例 3：创建 CAD 脚本

```
用户：/cad
用户：创建一个脚本，打开文件并插入门窗

Claude 会自动：
1. 使用标准的脚本模板
2. 导入正确的范式函数
3. 包含协同机制等待
4. 添加详细的日志输出
5. 包含错误处理
```

## 🎯 配置系统的工作原理

### 自动触发机制

当你的消息包含以下关键词时，Claude 会自动进入 CAD 规范模式：

**触发关键词**：
- CAD, AutoCAD, 天正, TArch
- DWG, 图纸, dwg
- 打开, 新建, 关闭, 保存
- 插入, 块, block
- 墙体, 门, 窗, 标注
- 测试, test, 脚本

**自动行为**：
1. 识别任务类型
2. 阅读相关规范文档
3. 使用正确的函数和模式
4. 遵循协同机制
5. 详细记录日志

### 强制规则

配置系统强制 Claude 遵循以下规则：

1. **必须通过天正启动 CAD**（不直接启动 CAD）
2. **必须启动弹窗治理脚本**
3. **必须使用范式函数**（禁止直接调用 COM API）
4. **必须遵循协同机制**（每个命令后等待完成）
5. **必须详细记录日志**

## 📚 配置文件详解

### 1. CLAUDE_BEHAVIOR_RULES.md

**位置**：`.claude/CLAUDE_BEHAVIOR_RULES.md`

**内容**：10条强制性行为规则

**关键规则**：
- 规则 1：CAD 操作前必读文档
- 规则 2：必须使用范式函数
- 规则 3：协同机制强制执行
- 规则 4：启动 CAD 的标准流程
- 规则 5：测试任务的标准流程
- 规则 6：错误处理标准
- 规则 7：代码创建规范
- 规则 8：日志输出规范
- 规则 9：文件路径规范
- 规则 10：权限管理规范

**查看方式**：
```bash
cat .claude/CLAUDE_BEHAVIOR_RULES.md
```

### 2. commands/cad.md

**位置**：`.claude/commands/cad.md`

**作用**：定义 `/cad` 命令的行为

**内容**：
- 核心使命说明
- 必读文档列表
- 强制性操作规范
- 标准操作流程
- 错误处理规范
- 任务执行检查清单

**使用方式**：
```
/cad
```

### 3. commands/init.md

**位置**：`.claude/commands/init.md`

**作用**：定义 `/init` 命令的行为

**内容**：
- 环境信息
- 可用命令
- 权限配置
- 文档位置

**使用方式**：
```
/init
```

### 4. claude_config.json

**位置**：`.claude/claude_config.json`

**作用**：提供配置参数

**内容**：
- 工作站名称和版本
- 触发关键词列表
- 强制规则摘要
- 禁止操作列表
- 默认模块路径
- 权限配置

**查看方式**：
```bash
cat .claude/claude_config.json
```

## 🔧 自定义配置

### 添加新的触发关键词

编辑 `.claude/claude_config.json`：

```json
{
  "trigger_keywords": [
    "CAD", "AutoCAD", "天正",
    "你的新关键词"  // 添加这里
  ]
}
```

### 添加新的行为规则

编辑 `.claude/CLAUDE_BEHAVIOR_RULES.md`：

```markdown
### 规则 11：你的新规则

**强制要求：**
- ✅ 必须做什么
- ❌ 禁止做什么

**代码模板：**
\`\`\`python
# 正确的方式
...
\`\`\`
```

### 创建新的 Slash 命令

在 `.claude/commands/` 目录下创建新文件：

```bash
.claude/commands/mycommand.md
```

内容格式参考 `cad.md` 或 `init.md`。

使用方式：
```
/mycommand
```

## 📊 配置验证

### 运行验证脚本

```bash
python .claude/verify_config.py
```

### 验证内容

脚本会检查：
- ✅ 目录结构是否完整
- ✅ 配置文件是否存在
- ✅ JSON 格式是否正确
- ✅ 规范文档是否存在
- ✅ 核心模块是否存在

### 验证结果

**成功**：
```
✅ 所有配置检查通过！
通过率: 100.0%
```

**失败**：
```
❌ 失败: X 项
通过率: XX.X%

❌ 失败项详情:
  - [类型] 文件名
```

## 🎓 最佳实践

### 1. 每次新会话开始时

```
/init
```

了解环境状态和可用命令。

### 2. 执行 CAD 任务前

```
/cad
```

确保 Claude 理解并遵循规范。

### 3. 任务描述要清晰

**好的描述**：
```
打开 D:/test/sample.dwg 并在墙上插入门
```

**不好的描述**：
```
处理那个文件
```

### 4. 包含触发关键词

确保任务描述中包含"CAD"、"打开"、"插入"等关键词。

### 5. 定期验证配置

```bash
python .claude/verify_config.py
```

确保配置文件完整和正确。

## 🔍 故障排查

### 问题 1：Claude 没有按规范操作

**可能原因**：
- 没有使用 `/cad` 命令
- 任务描述不包含触发关键词

**解决方法**：
1. 明确使用 `/cad` 命令
2. 在任务描述中包含"CAD"等关键词
3. 明确说明要遵循规范

### 问题 2：Slash 命令不工作

**可能原因**：
- 文件扩展名不是 `.md`
- 文件位置不在 `commands/` 目录

**解决方法**：
1. 确保文件名为 `命令名.md`
2. 确保文件在 `.claude/commands/` 目录
3. 检查文件内容格式

### 问题 3：配置验证失败

**可能原因**：
- 文件缺失
- JSON 格式错误
- 路径不正确

**解决方法**：
1. 运行 `python .claude/verify_config.py` 查看详情
2. 根据失败项检查对应文件
3. 验证 JSON 格式

## 📝 配置文件清单

确保以下文件存在：

- [ ] `.claude/README.md`
- [ ] `.claude/CLAUDE_BEHAVIOR_RULES.md`
- [ ] `.claude/claude_config.json`
- [ ] `.claude/commands/init.md`
- [ ] `.claude/commands/cad.md`
- [ ] `.claude/verify_config.py`
- [ ] `CAD_操作规范.md`
- [ ] `CAD_基本操作范式.md`
- [ ] `CAD_快速参考.md`
- [ ] `CAD_测试规范.md`
- [ ] `scripts/CAD_basic_operations.py`
- [ ] `scripts/CAD_coordination.py`
- [ ] `scripts/CAD_enhanced_functions.py`

## 🎯 下一步

1. **验证配置**：
   ```bash
   python .claude/verify_config.py
   ```

2. **测试命令**：
   ```
   /init
   /cad
   ```

3. **执行任务**：
   ```
   /cad
   打开 D:/test/sample.dwg
   ```

4. **查看文档**：
   ```bash
   cat .claude/README.md
   cat .claude/CLAUDE_BEHAVIOR_RULES.md
   ```

## 💡 提示

- 配置系统是**自动生效**的，无需手动激活
- 使用 `/cad` 命令可以**强化**规范执行
- 配置文件可以**随时修改**和完善
- 验证脚本可以**随时运行**检查配置

---

**版本**：1.0
**创建日期**：2025-11-10
**文档位置**：`D:\claude-tasks\配置系统使用指南.md`

**如有问题，请查看 `.claude/README.md` 或运行验证脚本。**
