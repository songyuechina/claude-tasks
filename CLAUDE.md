# Claude Tasks 工作区文档规范

**版本**: v1.5
**更新日期**: 2025-11-14
**适用范围**: D:\claude-tasks 目录下所有项目

---

## 一、行为规范

本文档定义D:\claude-tasks工作区的统一规范，所有开发活动必须遵循本规范。

---

## 二、进度汇报和状态检查机制

### 2.1 任务期望设置

对于重要的任务，用户将在任务描述中明确设置期望：

```
这个任务请每隔Y分钟汇报进度
```

Claude必须按照指定的时间间隔主动汇报任务进度。

### 2.2 状态检查机制

在任务执行过程中，用户可能会发送状态检查消息：

```
状态检查：是否遇到问题？
```

**Claude收到此消息后必须立即回应：**

- **没有异常情况**：回复"一切正常"
- **有异常情况**：说明遇到的具体问题

### 2.3 任务进度汇报文件机制（CAD项目）

**文件路径**：`D:\claude-tasks\cad\任务进度汇报.txt`

**⚠️ 触发条件判断原则**：

任务描述中同时包含以下两个要素即触发：
1. **明确的时间间隔**（如"每隔10分钟"、"每10分钟"、"10分钟一次"）
2. **汇报/报告动作**（如"汇报进度"、"报告进展"、"更新进度"、"通报情况"）

**触发示例**：
- ✓ "请每隔10分钟汇报进度"
- ✓ "每10分钟报告一次进展"
- ✓ "这个任务需要每隔10分钟更新进度"
- ✓ "10分钟汇报一次任务状态"

**不触发示例**：
- ✗ "及时汇报进度"（无明确时间间隔）
- ✗ "每隔10分钟检查一次"（无汇报动作）
- ✗ "尽量多汇报进度"（无明确时间间隔）

**工作机制**（仅在触发条件满足时）：

1. **任务启动时**：
   - 清空文件全部内容
   - 写入当前时间和任务开始消息

2. **任务执行中**：
   - 按用户要求的时间间隔写入进度消息（如"每隔10分钟"）
   - **同时每60秒写入心跳时间戳**

3. **任务结束时**：
   - 写入任务完成时间和结束消息

**示例代码**：

```python
from datetime import datetime

# 任务启动时（仅在有汇报要求时）
with open("D:/claude-tasks/cad/任务进度汇报.txt", "w", encoding="utf-8") as f:
    f.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - 任务开始\n")

# 心跳时间戳（每60秒，仅在有汇报要求时）
with open("D:/claude-tasks/cad/任务进度汇报.txt", "a", encoding="utf-8") as f:
    f.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")

# 进度汇报时（按用户要求的时间间隔，如每10分钟）
with open("D:/claude-tasks/cad/任务进度汇报.txt", "a", encoding="utf-8") as f:
    f.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - [进度] 正在执行步骤X/Y\n")

# 任务结束时（仅在有汇报要求时）
with open("D:/claude-tasks/cad/任务进度汇报.txt", "a", encoding="utf-8") as f:
    f.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - 任务完成\n")
```

### 2.4 任务文件清理机制（CAD项目）

**即时对话.txt 清理规则**：

- **文件路径**：`D:\claude-tasks\cad\即时对话.txt`
- **清理时机**：每次任务结束时必须清空
- **清理方法**：

```python
# 任务完成后清空即时对话.txt
with open("D:/claude-tasks/cad/即时对话.txt", "w", encoding="utf-8") as f:
    f.write("")
```

**原因**：`/cad` 命令启动时会读取 `即时对话.txt`，如果不清空，下次启动会读取到旧任务内容。

### 2.5 即时对话任务格式规范（CAD项目）

**文件路径**：`D:\claude-tasks\cad\即时对话.txt`

#### 一、一般性对话格式

用于讨论、咨询、规范审查等不涉及CAD文件操作的对话。

```markdown
**任务类型**：一般性对话

{对话内容}
```

**任务完成清理**：
- 清空 `即时对话.txt`

#### 二、CAD操作任务格式

用于涉及DWG文件操作、脚本编写、测试等任务。

##### （一）简化版格式（适合较简单任务）

```markdown
<任务>

**任务类型**：CAD操作和函数、脚本处理

**目标**：{任务简述}

**要求**：
1. {要求1}
2. {要求2}
3. {要求3}

**文件路径**：{相关文件路径}

**完成标准**：{如何判断任务完成}

**强制规范**：
- 🔴 任务完成前必须调用cad_zt_zero()清理CAD进程
- 📝 清空即时对话.txt

**⚠️ 条件规范**（仅在任务明确要求时才执行）：
- 🔔 **仅当任务中有"### 关机信号"字段时**，设置可以结束对话.txt为1
- ⚠️ **警告**：设置为1会触发系统关机！没有此字段时绝对不能设置！

</任务>

<任务完成汇报>
我已经检查任务完成情况，确认任务已经完成。
</任务完成汇报>
```

##### （二）普通版格式（适合一般任务）

```markdown
# 任务：{任务名称}

**任务类型**：CAD操作和函数、脚本处理

## 1. 任务目标
{简要描述任务要达到的目的}

## 2. 具体要求
- [ ] 要求1：{具体描述}
- [ ] 要求2：{具体描述}
- [ ] 要求3：{具体描述}

## 3. 文件信息
- **输入文件**：{文件路径}
- **输出文件**：{文件路径}
- **测试文件位置**：{目录路径}

## 4. 技术要求
- 使用函数：{指定必须使用的函数}
- 性能要求：{如果有的话}
- 特殊注意：{特殊要求}

## 5. 完成标准
- [ ] 标准1：{如何判断完成}
- [ ] 标准2：{如何判断完成}
- [ ] 🔴 必须执行cad_zt_zero()清理所有CAD进程
- [ ] 📝 清空即时对话.txt

## 6. 关机信号（⚠️ 条件字段，仅在需要自动关机时添加）

**⚠️ 重要警告**：此字段会触发系统关机，仅在明确需要时才添加！

如需任务完成后自动关机，在任务中添加以下字段：
```markdown
### 关机信号
该任务结束后强制将 D:/claude-tasks/cad/可以结束对话.txt的内容改为1
```

**判断规则**：
- **有此字段** → Claude将在任务完成后设置结束信号为1（触发关机）
- **没有此字段** → Claude绝对不能设置结束信号（正常完成任务）

## 7. 完成汇报
任务完成后发送消息：
> 我已经检查任务完成情况，确认任务已经完成。
```

##### （三）复杂版格式（适合复杂困难任务）

```markdown
# 任务检查清单

## 任务名称：{任务名称}

**任务类型**：CAD操作和函数、脚本处理

### 前置准备
- [ ] 确认文件路径存在
- [ ] 确认CAD环境可用
- [ ] 已读取相关规范文档

### 进度管理（可选，仅在需要时添加）

**使用场景**：任务预计执行时间较长（如>15分钟），需要监控进度

**触发条件**：任务中包含"明确时间间隔 + 汇报动作"

**标准格式**：
```markdown
**进度汇报要求**：
请每隔 {T3} 分钟汇报进度（如T3=10分钟）
```

**其他有效表述**：
- "每10分钟报告一次进展"
- "任务执行中每隔5分钟更新进度"
- "10分钟汇报一次任务状态"

**触发后Claude的行为**：
- 每隔T3分钟汇报进度，写入D:/claude-tasks/cad/任务进度汇报.txt
- 每60秒写入心跳时间戳

**注意**：如果任务较简单（如<5分钟），不需要添加进度汇报要求。

### 状态检查
对接到的消息"状态检查：是否遇到问题？"

- 没有异常就回复：一切正常
- 有异常情况就回复：说明遇到的具体问题

### 执行步骤
- [ ] 步骤1：{具体描述} - 预期结果：{xxx}
- [ ] 步骤2：{具体描述} - 预期结果：{xxx}
- [ ] 步骤3：{具体描述} - 预期结果：{xxx}

### 质量检查
- [ ] 是否使用了CAD_file_operations.py？
- [ ] 是否使用了天正操作函数？
- [ ] 执行时间是否在合理范围？
- [ ] 是否生成了预期文件？

### 🔴 任务完成清理（最重要！）

**强制清理项（所有任务都必须执行）**：
- [ ] 测试开始前调用cad_zt_zero()
- [ ] 测试脚本finally块调用cad_zt_zero()
- [ ] **任务完成前再次调用cad_zt_zero()**
- [ ] **清空即时对话.txt**

**条件清理项（仅在任务明确要求时）**：
- [ ] ⚠️ **仅当任务中有"进度汇报要求"字段时**，在任务进度汇报.txt写入完成消息
- [ ] ⚠️ **仅当任务中有"### 关机信号"字段时**，设置可以结束对话.txt为1
- [ ] ⚠️ **没有这些字段时，跳过对应步骤！**

### 完成汇报
所有检查项完成后发送：
> 我已经检查任务完成情况，确认任务已经完成。
```

### 2.6 适用范围

- **重要任务**：必须按要求汇报进度，响应状态检查
- **一般任务**：不必作状态检查

---

## 三、语言规范

都是用中文回复。

---

## 四、目录结构规范

### 4.1 顶层目录结构

```
D:\claude-tasks\
├── .claude/              # Claude配置目录（行为规则、命令定义）
├── .git/                 # Git版本控制
├── cad/                  # CAD自动化开发项目
├── su/                   # SketchUp开发项目
├── video/                # 视频处理项目
├── wenben/               # 文本处理项目
├── zonghe/               # 综合项目
├── CLAUDE.md             # 本文档（文档规范）
└── README.md             # 项目总览

总计文件统计：
- Python文件：144个
- Markdown文档：56个
- DWG文件：53个
- 文本文件：3个
```

### 4.2 子项目结构

每个子项目应包含：
- `scripts/` - 核心脚本
- `tests/` - 测试脚本
- `test_reports/` - 测试报告
- `examples/` - 示例代码
- `README.md` - 项目说明
- `CLAUDE.md` - 项目特定规范（可选）

---

## 五、文档命名规范

### 5.1 文档类型与命名

| 文档类型 | 命名格式 | 示例 | 位置 |
|---------|---------|------|------|
| 规范文档 | `{模块}_规范.md` | `CAD_操作规范.md` | 项目根目录 |
| 参考文档 | `{模块}_快速参考.md` | `CAD_快速参考.md` | 项目根目录 |
| 范式文档 | `{模块}_基本操作范式.md` | `CAD_基本操作范式.md` | 项目根目录 |
| 测试报告 | `{功能}_测试报告.md` | `最终完整测试报告.md` | tests/ |
| Excel报告 | `{模块}测试报告_YYYYMMDD_HHMMSS.xlsx` | `CAD函数测试报告_20251113_003704.xlsx` | test_reports/ |
| 实现报告 | `{功能}_实现报告.md` | `CAD 协同机制实现报告.md` | 项目根目录 |
| README | `README.md` | `README.md` | 各级目录 |

### 5.2 代码文件命名

| 文件类型 | 命名格式 | 示例 |
|---------|---------|------|
| 核心模块 | `{模块}_basic.py` | `CAD_basic.py` |
| 功能模块 | `{模块}_{功能}.py` | `CAD_file_operations.py` |
| 测试脚本 | `test_{功能}.py` | `test_insert_tarch_door_triangle.py` |
| 示例脚本 | `{功能}_example.py` | `CAD_file_operations_example.py` |
| 临时脚本 | `temp_{功能}.py` | `temp_transfer_props.py` |

---

## 六、文档内容规范

### 6.1 必备章节结构

所有规范文档必须包含：

```markdown
# 文档标题

**版本**: vX.X
**更新日期**: YYYY-MM-DD
**状态**: 草稿/审核中/已发布

---

## 一、概述
[文档目的、适用范围]

## 二、核心内容
[主要规范、规则、流程]

## 三、示例
[代码示例、使用案例]

## 四、注意事项
[重要提醒、常见错误]

## 五、参考资料
[相关文档链接]
```

### 6.2 测试报告必备内容

```markdown
# {功能}测试报告

**测试日期**: YYYY-MM-DD
**测试环境**: [环境描述]
**测试覆盖率**: XX%

## 执行摘要
- 总函数数
- 测试通过数
- 实际可用率

## 详细测试结果
[按模块分类的测试结果表格]

## Bug修复记录
[已修复的bug清单]

## 性能统计
[执行时间、性能指标]

## 结论与建议
```

---

## 七、代码规范

### 7.1 Python文件头部

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
模块简要描述

详细说明（可选）
"""

import sys
from pathlib import Path

# 模块导入
# 常量定义
# 函数定义
```

### 7.2 函数文档字符串

```python
def function_name(param1, param2):
    """
    函数简要描述

    Args:
        param1: 参数1说明
        param2: 参数2说明

    Returns:
        返回值说明

    示例:
        >>> function_name(value1, value2)
        expected_result
    """
```

### 7.3 测试脚本结构

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
测试{功能}
"""

import sys
from pathlib import Path

# 添加路径
SCRIPT_DIR = Path(__file__).parent.parent / "scripts"
sys.path.insert(0, str(SCRIPT_DIR))

# 导入模块
from module_name import *

def test_function():
    """测试函数说明"""
    print("="*60)
    print("测试{功能}")
    print("="*60)

    try:
        # 测试步骤
        pass
    except Exception as e:
        print(f"[错误] {e}")
        return False
    finally:
        # 清理
        pass

if __name__ == "__main__":
    success = test_function()
    sys.exit(0 if success else 1)
```

---

## 八、测试报告规范

### 8.1 Excel报告结构

测试报告必须包含以下工作表：

1. **测试详情**
   - 函数名
   - 测试状态
   - 执行时间
   - 测试脚本
   - 测试文件
   - 文件位置
   - 说明

2. **测试汇总**
   - 总函数数
   - 测试通过数
   - 测试覆盖率
   - 实际可用率
   - 测试日期
   - 测试环境

3. **Bug修复记录**
   - Bug编号
   - 文件名
   - 行号
   - 问题描述
   - 修复方案
   - 修复状态

4. **测试文件清单**
   - 文件名
   - 文件类型
   - 用途说明
   - 文件位置

### 8.2 测试文件存档

- 所有测试文件必须保存在 `test_reports/test_files/`
- 文件名必须与测试报告中记录一致
- 必须包含README.md说明如何复测

---

## 九、版本控制规范

### 9.1 Git提交信息格式

```
<type>: <subject>

<body>

<footer>
```

类型（type）：
- `feat`: 新功能
- `fix`: Bug修复
- `docs`: 文档更新
- `test`: 测试相关
- `refactor`: 重构
- `style`: 代码格式
- `chore`: 构建/工具

示例：
```
fix: 修复天正墙命令卡住问题

- 在draw_tarch_wall()中增加额外的\n
- 墙体绘制时间从>60秒降低到3.4-4.0秒
- 增加重试机制处理COM错误

Closes #123
```

### 9.2 分支命名

- `main`: 主分支
- `dev`: 开发分支
- `feature/{功能名}`: 功能分支
- `fix/{bug名}`: 修复分支
- `test/{测试名}`: 测试分支

---

## 十、文档维护规范

### 10.1 更新频率

- **规范文档**: 发现问题立即更新
- **测试报告**: 每次测试后生成新报告
- **README**: 目录结构变化时更新
- **本文档**: 规范变化时更新

### 10.2 文档审核

重要文档更新需要：
1. 标注版本号
2. 记录更新日期
3. 说明更新内容
4. 保留历史版本（如需要）

### 10.3 文档归档

- 过期文档移至 `archive/` 目录
- 保留最近3个版本的测试报告
- 临时文档定期清理

---

## 十一、项目特定规范

各子项目可在其目录下创建 `CLAUDE.md` 文件，定义项目特定的规范和要求。项目特定规范优先级高于本通用规范。

---

**本文档是D:\claude-tasks目录下所有项目的统一规范，所有开发活动必须遵循本规范。**
